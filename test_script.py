import re
import requests
import sys

# Define the target domain
#if arguments are <2 then there is no domain
if len(sys.argv) < 2:
    print("No domain provided")
    sys.exit(1)
else:
    url = sys.argv[1]
    print(url)

try:
    test = requests.get("https://"+url)
    if (test.status_code >= 404):
        print("Invalid domain entered")
        sys.exit(1)
except Exception as error:
    print("Some exception occurred: "+error)

# Define the input file paths
subdomains_file = 'subdomains_dictionary.bat'
directories_file = 'dirs_dictionary.bat'
response = requests.get("https://" + url)
html = response.text

# Read the subdomains and directories from the input files
subdomains = []
i=0
with open(subdomains_file, 'r') as f:
    for line in f.readlines():
        temp = line.strip()
        # remove extra spaces
        subdomains.append(re.sub(' +', ' ', temp))
        # remove trailing special characters
        subdomains[i] = re.sub('[^a-zA-Z0-9\n\.\?! ]+', '', subdomains[i])
        i+=1

directories = []
i=0
with open(directories_file, 'r') as f:
    for line in f.readlines():
        temp = line.strip()
        # remove extra spaces
        directories.append(re.sub(' +', ' ', temp))
        # remove trailing special characters
        directories[i] = re.sub('[^a-zA-Z0-9\n\.\?! ]+', '', directories[i])
        i+=1

# Initialize the output lists
subdomains_output = []
directories_output = []
files_output = []

# find all href attributes in <a> tags and extract their values
hrefs = re.findall('<a.*?href="(.*?)".*?>', html)

# remove any duplicates
files_output = list(set(hrefs))

# print the unique href values
for href in files_output:
    print(href)

# Loop through all subdomains 
for subdomain in subdomains:
    suburl = 'https://'+subdomain+'.'+url
    print(suburl)
    try:
        response = requests.get(suburl)
    except:
        #if an exception was found while checking for the sub-domain, just move over to the next sub domain.
        continue

    # Check if the response is successful (status code 200-299)
    if response.status_code >= 200 and response.status_code < 300:
        subdomains_output.append(suburl)
        print("subdomain ",subdomain," succeeded stts code: ",response.status_code)

# Loop through all directories
for directory in directories:
    dirurl = 'https://'+url+'/'+directory
    print(dirurl)
    try:
        response = requests.get(dirurl)  
    except:
        #if an exception was found while checking for the directory, just move over to the next dir.
        continue

    # Check if the response is successful (status code 200-299)
    if response.status_code >= 200 and response.status_code < 300:            
        directories_output.append(dirurl)
        print("directory ",directory," succeeded stts code: ",response.status_code)

